<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Original â€” Admin</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORIGINAL ADMIN â€” Design: Industrial Fire Command Center
   Fundo carvÃ£o + brasas + detalhes metÃ¡licos
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --r1:#FF2200;--r2:#FF5500;--r3:#FF8800;--r4:#FFAA00;
  --bg:#080808;--s1:#0F0F0F;--s2:#161616;--s3:#1E1E1E;--s4:#282828;
  --bd:rgba(255,85,0,.15);--bd2:rgba(255,85,0,.3);
  --tx:#D0D0D0;--tx2:#888;--tx3:#555;
  --green:#00FF88;--red:#FF3344;--yellow:#FFCC00;
  --r: 10px;
  --font:'Syne',sans-serif;
  --head:'Bebas Neue',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{background:var(--bg);color:var(--tx);font-family:var(--font);min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--s1)}
::-webkit-scrollbar-thumb{background:var(--r2);border-radius:3px}

/* â”€ grain overlay â”€ */
body::before{
  content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.03'/%3E%3C/svg%3E");
  pointer-events:none;z-index:0;opacity:.4;
}

/* â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#loginScreen{
  display:flex;align-items:center;justify-content:center;
  min-height:100vh;position:relative;z-index:1;
}
.login-box{
  width:400px;
  background:var(--s1);
  border:1px solid var(--bd);
  border-radius:16px;
  padding:48px 40px;
  text-align:center;
  box-shadow:0 0 60px rgba(255,85,0,.06),0 24px 48px rgba(0,0,0,.6);
  position:relative;overflow:hidden;
}
.login-box::before{
  content:'';position:absolute;bottom:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--r2),transparent);
}
.login-logo{width:64px;height:64px;object-fit:contain;margin:0 auto 20px;
  filter:drop-shadow(0 0 16px rgba(255,85,0,.8));
  animation:glow 2s ease-in-out infinite;
}
@keyframes glow{0%,100%{filter:drop-shadow(0 0 16px rgba(255,85,0,.8))}50%{filter:drop-shadow(0 0 28px rgba(255,154,0,.9))}}
.login-title{font-family:var(--head);font-size:36px;letter-spacing:4px;
  background:linear-gradient(90deg,var(--r1),var(--r3));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px;}
.login-sub{font-size:12px;color:var(--tx3);letter-spacing:1px;text-transform:uppercase;margin-bottom:32px}
.login-field{position:relative;margin-bottom:16px;text-align:left}
.login-field label{display:block;font-size:11px;color:var(--tx2);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px}
.login-field input{
  width:100%;background:var(--s2);border:1px solid var(--s4);border-radius:8px;
  padding:12px 16px;color:var(--tx);font-family:var(--font);font-size:14px;outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.login-field input:focus{border-color:var(--r2);box-shadow:0 0 0 3px rgba(255,85,0,.12)}
.login-field input::placeholder{color:var(--tx3)}
.btn-login{
  width:100%;padding:13px;background:linear-gradient(135deg,var(--r1),var(--r2));
  border:none;border-radius:8px;color:#fff;font-family:var(--font);font-size:14px;
  font-weight:700;letter-spacing:.5px;cursor:pointer;
  box-shadow:0 4px 20px rgba(255,45,0,.35);transition:all .2s;margin-top:8px;
}
.btn-login:hover{transform:translateY(-1px);box-shadow:0 8px 28px rgba(255,45,0,.5)}
.login-err{font-size:12px;color:var(--red);margin-top:10px;min-height:18px}

/* â• APP SHELL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{display:none;min-height:100vh;position:relative;z-index:1}

/* â”€ Sidebar â”€ */
.sidebar{
  width:220px;position:fixed;top:0;left:0;bottom:0;
  background:var(--s1);border-right:1px solid var(--bd);
  display:flex;flex-direction:column;z-index:50;
}
.sidebar-logo{
  padding:24px 20px 20px;border-bottom:1px solid var(--bd);
  display:flex;align-items:center;gap:12px;
}
.sidebar-logo img{width:30px;height:30px;object-fit:contain;filter:drop-shadow(0 0 8px rgba(255,85,0,.7))}
.sidebar-brand{font-family:var(--head);font-size:22px;letter-spacing:3px;
  background:linear-gradient(90deg,var(--r2),var(--r4));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sidebar-ver{font-size:9px;color:var(--tx3);letter-spacing:1px;margin-top:-2px}
.nav{flex:1;padding:16px 12px;overflow-y:auto}
.nav-section{font-size:9px;color:var(--tx3);letter-spacing:2px;text-transform:uppercase;padding:8px 8px 6px;margin-top:8px}
.nav-item{
  display:flex;align-items:center;gap:10px;padding:9px 10px;
  border-radius:7px;cursor:pointer;color:var(--tx2);
  font-size:13px;font-weight:500;transition:all .15s;margin-bottom:2px;
}
.nav-item:hover{background:var(--s3);color:var(--tx)}
.nav-item.active{background:rgba(255,85,0,.12);color:var(--r2);border:1px solid rgba(255,85,0,.2)}
.nav-icon{width:16px;text-align:center;font-size:14px;flex-shrink:0}
.sidebar-foot{
  padding:16px;border-top:1px solid var(--bd);
  font-size:11px;color:var(--tx3);display:flex;align-items:center;justify-content:space-between;
}
.btn-logout{background:none;border:none;color:var(--tx3);cursor:pointer;font-size:11px;font-family:var(--font);
  transition:color .2s;}
.btn-logout:hover{color:var(--red)}

/* â”€ Main content â”€ */
.content{margin-left:220px;padding:28px;min-height:100vh}

/* â”€ Page header â”€ */
.page-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px}
.page-title{font-family:var(--head);font-size:28px;letter-spacing:2px;color:var(--tx)}
.page-sub{font-size:12px;color:var(--tx3);margin-top:2px}

/* â”€ Stat cards â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.stat-card{
  background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);
  padding:18px 20px;position:relative;overflow:hidden;transition:border-color .2s;
}
.stat-card:hover{border-color:var(--bd2)}
.stat-card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,var(--accent,var(--r2)),transparent);opacity:.6;
}
.stat-card.green{--accent:var(--green)}
.stat-card.red{--accent:var(--red)}
.stat-card.yellow{--accent:var(--yellow)}
.stat-label{font-size:10px;color:var(--tx3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px}
.stat-val{font-family:var(--head);font-size:40px;color:var(--tx);line-height:1}
.stat-val.green{color:var(--green)}
.stat-val.red{color:var(--red)}
.stat-val.yellow{color:var(--yellow)}
.stat-val.orange{color:var(--r3)}
.stat-sub{font-size:11px;color:var(--tx3);margin-top:4px}

/* â”€ Card â”€ */
.card{
  background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);
  overflow:hidden;margin-bottom:20px;
}
.card-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:16px 20px;border-bottom:1px solid var(--bd);
}
.card-title{font-size:13px;font-weight:700;letter-spacing:.5px;color:var(--tx)}
.card-body{padding:20px}

/* â”€ Table â”€ */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
th{
  text-align:left;padding:10px 14px;font-size:10px;letter-spacing:1.5px;
  text-transform:uppercase;color:var(--tx3);border-bottom:1px solid var(--bd);
  font-weight:600;white-space:nowrap;
}
td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.03);color:var(--tx);white-space:nowrap}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.02)}
.mono{font-family:monospace;font-size:12px;color:var(--r3);letter-spacing:.5px}

/* â”€ Badges â”€ */
.badge{
  display:inline-flex;align-items:center;gap:4px;
  padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;
}
.badge-active{background:rgba(0,255,136,.1);color:var(--green);border:1px solid rgba(0,255,136,.2)}
.badge-suspended{background:rgba(255,51,68,.1);color:var(--red);border:1px solid rgba(255,51,68,.2)}
.badge-expired{background:rgba(136,136,136,.1);color:var(--tx2);border:1px solid rgba(136,136,136,.2)}
.badge-pending{background:rgba(255,204,0,.1);color:var(--yellow);border:1px solid rgba(255,204,0,.2)}
.badge-pro{background:rgba(255,85,0,.1);color:var(--r2);border:1px solid rgba(255,85,0,.2)}
.badge-trial{background:rgba(255,204,0,.1);color:var(--yellow);border:1px solid rgba(255,204,0,.2)}
.badge-lifetime{background:rgba(0,255,136,.1);color:var(--green);border:1px solid rgba(0,255,136,.2)}

/* â”€ Buttons â”€ */
.btn{
  display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:7px;
  font-family:var(--font);font-size:13px;font-weight:600;cursor:pointer;
  border:none;transition:all .15s;letter-spacing:.2px;
}
.btn-primary{background:linear-gradient(135deg,var(--r1),var(--r2));color:#fff;
  box-shadow:0 3px 12px rgba(255,45,0,.3)}
.btn-primary:hover{box-shadow:0 5px 20px rgba(255,45,0,.5);transform:translateY(-1px)}
.btn-ghost{background:transparent;color:var(--tx2);border:1px solid var(--s4)}
.btn-ghost:hover{border-color:var(--r2);color:var(--r2)}
.btn-danger{background:rgba(255,51,68,.12);color:var(--red);border:1px solid rgba(255,51,68,.2)}
.btn-danger:hover{background:rgba(255,51,68,.2)}
.btn-sm{padding:5px 10px;font-size:11px;border-radius:5px}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}

/* â”€ Form â”€ */
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.form-grid.cols3{grid-template-columns:1fr 1fr 1fr}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-group.full{grid-column:1/-1}
.form-label{font-size:11px;color:var(--tx2);letter-spacing:.8px;text-transform:uppercase}
.form-input,.form-select{
  background:var(--s2);border:1px solid var(--s4);border-radius:7px;
  padding:9px 12px;color:var(--tx);font-family:var(--font);font-size:13px;outline:none;
  transition:border-color .2s;width:100%;
}
.form-input:focus,.form-select:focus{border-color:var(--r2);box-shadow:0 0 0 3px rgba(255,85,0,.1)}
.form-input::placeholder{color:var(--tx3)}
.form-select{cursor:pointer}
.form-select option{background:var(--s2)}

/* â”€ Modal â”€ */
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.75);
  display:none;align-items:center;justify-content:center;z-index:200;
  backdrop-filter:blur(4px);
}
.modal-overlay.open{display:flex}
.modal{
  background:var(--s1);border:1px solid var(--bd2);border-radius:14px;
  width:520px;max-width:calc(100vw - 40px);
  box-shadow:0 24px 60px rgba(0,0,0,.6),0 0 40px rgba(255,85,0,.05);
  overflow:hidden;
}
.modal-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 24px;border-bottom:1px solid var(--bd);
}
.modal-title{font-family:var(--head);font-size:20px;letter-spacing:2px;color:var(--tx)}
.modal-close{background:none;border:none;color:var(--tx3);cursor:pointer;font-size:20px;
  width:28px;height:28px;display:flex;align-items:center;justify-content:center;
  border-radius:5px;transition:all .15s}
.modal-close:hover{background:var(--s3);color:var(--tx)}
.modal-body{padding:24px}
.modal-foot{display:flex;gap:10px;justify-content:flex-end;padding:16px 24px;border-top:1px solid var(--bd)}

/* â”€ Search bar â”€ */
.search-bar{display:flex;gap:10px;align-items:center}
.search-input{
  background:var(--s2);border:1px solid var(--s4);border-radius:7px;
  padding:8px 14px;color:var(--tx);font-family:var(--font);font-size:13px;outline:none;
  transition:border-color .2s;min-width:220px;
}
.search-input:focus{border-color:var(--r2)}
.search-input::placeholder{color:var(--tx3)}
.filter-select{
  background:var(--s2);border:1px solid var(--s4);border-radius:7px;
  padding:8px 12px;color:var(--tx2);font-family:var(--font);font-size:12px;outline:none;cursor:pointer;
}

/* â”€ Alert toast â”€ */
#toast{
  position:fixed;top:20px;right:20px;z-index:999;
  display:none;animation:slideIn .3s ease;
}
#toast.show{display:block}
@keyframes slideIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
.toast-inner{
  padding:12px 18px;border-radius:8px;font-size:13px;font-weight:500;
  box-shadow:0 8px 24px rgba(0,0,0,.4);min-width:240px;
}
.toast-success{background:rgba(0,255,136,.1);border:1px solid rgba(0,255,136,.3);color:var(--green)}
.toast-error{background:rgba(255,51,68,.1);border:1px solid rgba(255,51,68,.3);color:var(--red)}

/* â”€ Pagination â”€ */
.pagination{display:flex;align-items:center;gap:8px;padding:14px 20px;border-top:1px solid var(--bd)}
.page-info{font-size:12px;color:var(--tx3);flex:1}
.page-btn{padding:5px 12px;border-radius:5px;background:var(--s2);border:1px solid var(--s4);
  color:var(--tx2);cursor:pointer;font-size:12px;font-family:var(--font);transition:all .15s}
.page-btn:hover{border-color:var(--r2);color:var(--r2)}
.page-btn:disabled{opacity:.3;cursor:not-allowed}

/* â”€ Empty state â”€ */
.empty{text-align:center;padding:48px 20px;color:var(--tx3)}
.empty-icon{font-size:40px;margin-bottom:12px}
.empty-text{font-size:14px}

/* â”€ Log row â”€ */
.log-row{display:flex;align-items:center;gap:12px;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.03)}
.log-row:last-child{border-bottom:none}
.log-action{font-size:11px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;
  padding:2px 8px;border-radius:4px;}
.log-time{font-size:11px;color:var(--tx3);min-width:140px}
.log-email{font-size:12px;color:var(--tx2);flex:1}
.log-validate{background:rgba(0,136,255,.1);color:#4DA6FF}
.log-activate{background:rgba(0,255,136,.1);color:var(--green)}
.log-send_message{background:rgba(255,85,0,.1);color:var(--r2)}

/* â”€ Key preview box â”€ */
.key-box{
  background:var(--s3);border:1px solid var(--bd2);border-radius:8px;
  padding:10px 16px;font-family:monospace;font-size:13px;color:var(--r3);
  letter-spacing:2px;cursor:pointer;transition:all .2s;display:flex;
  align-items:center;justify-content:space-between;
}
.key-box:hover{background:var(--s4);border-color:var(--r2)}

/* â”€ Generated keys list â”€ */
#generatedKeys{margin-top:16px;display:none}
.gen-key-item{
  display:flex;align-items:center;gap:10px;padding:9px 14px;
  background:var(--s2);border-radius:7px;margin-bottom:6px;
  border:1px solid var(--s4);
}
.gen-key-text{font-family:monospace;font-size:13px;color:var(--r3);flex:1;letter-spacing:1px}

/* â”€ Responsive â”€ */
@media(max-width:900px){
  .stats-grid{grid-template-columns:1fr 1fr}
  .form-grid.cols3{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<!-- â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toast"><div class="toast-inner" id="toastInner"></div></div>

<!-- â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen">
  <div class="login-box">
    <img src="https://i.imgur.com/placeholder.png" class="login-logo" id="loginLogo" onerror="this.style.display='none'">
    <div style="font-size:48px;margin-bottom:16px" id="logoEmoji">ğŸ”¥</div>
    <div class="login-title">ORIGINAL</div>
    <div class="login-sub">Painel Administrativo</div>

    <div class="login-field">
      <label>Senha Master</label>
      <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off">
    </div>
    <button class="btn-login" onclick="doLogin()">Entrar no Painel</button>
    <div class="login-err" id="loginErr"></div>
  </div>
</div>

<!-- â•â• APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">

  <!-- â”€ Sidebar â”€ -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <div style="font-size:24px">ğŸ”¥</div>
      <div>
        <div class="sidebar-brand">ORIGINAL</div>
        <div class="sidebar-ver">Admin v1.0</div>
      </div>
    </div>

    <nav class="nav">
      <div class="nav-section">Principal</div>
      <div class="nav-item active" onclick="goPage('dashboard')">
        <span class="nav-icon">ğŸ“Š</span> Dashboard
      </div>
      <div class="nav-item" onclick="goPage('licenses')">
        <span class="nav-icon">ğŸ”‘</span> LicenÃ§as
      </div>
      <div class="nav-item" onclick="goPage('generate')">
        <span class="nav-icon">âœ¨</span> Gerar LicenÃ§as
      </div>

      <div class="nav-section">Monitoramento</div>
      <div class="nav-item" onclick="goPage('logs')">
        <span class="nav-icon">ğŸ“‹</span> Logs de Uso
      </div>

      <div class="nav-section">Sistema</div>
      <div class="nav-item" onclick="goPage('settings')">
        <span class="nav-icon">âš™ï¸</span> ConfiguraÃ§Ãµes
      </div>
    </nav>

    <div class="sidebar-foot">
      <span id="adminLabel">Admin</span>
      <button class="btn-logout" onclick="doLogout()">Sair</button>
    </div>
  </div>

  <!-- â”€ Content â”€ -->
  <div class="content">

    <!-- PAGE: DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="pageDashboard" class="page">
      <div class="page-header">
        <div>
          <div class="page-title">DASHBOARD</div>
          <div class="page-sub">VisÃ£o geral do sistema Original</div>
        </div>
        <button class="btn btn-primary" onclick="loadDashboard()">â†» Atualizar</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total de LicenÃ§as</div>
          <div class="stat-val" id="sTotalLicenses">â€”</div>
          <div class="stat-sub">Todas criadas</div>
        </div>
        <div class="stat-card green">
          <div class="stat-label">Ativas</div>
          <div class="stat-val green" id="sActiveLicenses">â€”</div>
          <div class="stat-sub">Em uso agora</div>
        </div>
        <div class="stat-card red">
          <div class="stat-label">Suspensas</div>
          <div class="stat-val red" id="sSuspendedLicenses">â€”</div>
          <div class="stat-sub">Bloqueadas</div>
        </div>
        <div class="stat-card yellow">
          <div class="stat-label">ValidaÃ§Ãµes Hoje</div>
          <div class="stat-val orange" id="sValidationsToday">â€”</div>
          <div class="stat-sub">Ãšltimas 24h</div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div class="card-title">ğŸ”¥ Atividade Recente</div>
          <button class="btn btn-ghost btn-sm" onclick="loadLogs()">Ver todos</button>
        </div>
        <div id="dashLogs">
          <div class="empty"><div class="empty-icon">â³</div><div class="empty-text">Carregando...</div></div>
        </div>
      </div>
    </div>

    <!-- PAGE: LICENSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="pageLicenses" class="page" style="display:none">
      <div class="page-header">
        <div>
          <div class="page-title">LICENÃ‡AS</div>
          <div class="page-sub">Gerencie todas as licenÃ§as do sistema</div>
        </div>
        <div style="display:flex;gap:10px">
          <button class="btn btn-ghost" onclick="exportCSV()">â¬‡ Exportar CSV</button>
          <button class="btn btn-primary" onclick="openCreateModal()">+ Nova LicenÃ§a</button>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div class="search-bar">
            <input class="search-input" id="searchInput" placeholder="Buscar por chave ou email..." oninput="filterLicenses()">
            <select class="filter-select" id="filterStatus" onchange="filterLicenses()">
              <option value="">Todos os status</option>
              <option value="active">Ativa</option>
              <option value="suspended">Suspensa</option>
              <option value="expired">Expirada</option>
              <option value="pending">Pendente</option>
            </select>
            <select class="filter-select" id="filterPlan" onchange="filterLicenses()">
              <option value="">Todos os planos</option>
              <option value="pro">Pro</option>
              <option value="trial">Trial</option>
              <option value="lifetime">Lifetime</option>
            </select>
          </div>
          <div style="font-size:12px;color:var(--tx3)" id="licenseCount">â€”</div>
        </div>
        <div class="tbl-wrap">
          <table>
            <thead>
              <tr>
                <th>Chave</th>
                <th>Email</th>
                <th>Plano</th>
                <th>Status</th>
                <th>AtivaÃ§Ãµes</th>
                <th>Criada em</th>
                <th>Expira em</th>
                <th>AÃ§Ãµes</th>
              </tr>
            </thead>
            <tbody id="licenseTbody">
              <tr><td colspan="8"><div class="empty"><div class="empty-icon">â³</div></div></td></tr>
            </tbody>
          </table>
        </div>
        <div class="pagination">
          <div class="page-info" id="pageInfo">â€”</div>
          <button class="page-btn" id="btnPrev" onclick="changePage(-1)" disabled>â† Anterior</button>
          <button class="page-btn" id="btnNext" onclick="changePage(1)" disabled>PrÃ³xima â†’</button>
        </div>
      </div>
    </div>

    <!-- PAGE: GENERATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="pageGenerate" class="page" style="display:none">
      <div class="page-header">
        <div>
          <div class="page-title">GERAR LICENÃ‡AS</div>
          <div class="page-sub">Crie novas chaves de licenÃ§a rapidamente</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
        <!-- Form -->
        <div class="card">
          <div class="card-head"><div class="card-title">âš™ï¸ ConfiguraÃ§Ãµes</div></div>
          <div class="card-body">
            <div class="form-grid" style="gap:16px">
              <div class="form-group">
                <label class="form-label">Plano</label>
                <select class="form-select" id="genPlan">
                  <option value="pro">Pro</option>
                  <option value="trial">Trial</option>
                  <option value="lifetime">Lifetime</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Quantidade</label>
                <input class="form-input" type="number" id="genQty" value="1" min="1" max="100">
              </div>
              <div class="form-group">
                <label class="form-label">MÃ¡x. AtivaÃ§Ãµes</label>
                <input class="form-input" type="number" id="genMaxAct" value="1" min="1">
              </div>
              <div class="form-group">
                <label class="form-label">Expira em (dias)</label>
                <input class="form-input" type="number" id="genExpires" placeholder="Deixe vazio = sem expiraÃ§Ã£o">
              </div>
              <div class="form-group full">
                <label class="form-label">Email (opcional)</label>
                <input class="form-input" type="email" id="genEmail" placeholder="Vincular a um email especÃ­fico">
              </div>
              <div class="form-group full">
                <label class="form-label">Notas internas</label>
                <input class="form-input" id="genNotes" placeholder="Ex: venda #123, cliente JoÃ£o...">
              </div>
            </div>
            <button class="btn btn-primary" style="margin-top:20px;width:100%" onclick="generateLicenses()">
              ğŸ”¥ Gerar LicenÃ§a(s)
            </button>
          </div>
        </div>

        <!-- Generated keys -->
        <div class="card">
          <div class="card-head">
            <div class="card-title">âœ¨ Chaves Geradas</div>
            <button class="btn btn-ghost btn-sm" id="btnCopyAll" onclick="copyAllKeys()" style="display:none">ğŸ“‹ Copiar Todas</button>
          </div>
          <div class="card-body" id="generatedKeysArea">
            <div class="empty">
              <div class="empty-icon">ğŸ”‘</div>
              <div class="empty-text">As chaves geradas aparecerÃ£o aqui</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: LOGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="pageLogs" class="page" style="display:none">
      <div class="page-header">
        <div>
          <div class="page-title">LOGS DE USO</div>
          <div class="page-sub">Registro de todas as atividades</div>
        </div>
        <button class="btn btn-primary" onclick="loadLogs()">â†» Atualizar</button>
      </div>

      <div class="card">
        <div class="card-head"><div class="card-title">ğŸ“‹ Atividade Recente</div></div>
        <div id="logsContainer">
          <div class="empty"><div class="empty-icon">â³</div><div class="empty-text">Carregando...</div></div>
        </div>
      </div>
    </div>

    <!-- PAGE: SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="pageSettings" class="page" style="display:none">
      <div class="page-header">
        <div>
          <div class="page-title">CONFIGURAÃ‡Ã•ES</div>
          <div class="page-sub">ConfiguraÃ§Ãµes do sistema</div>
        </div>
      </div>

      <div class="card">
        <div class="card-head"><div class="card-title">ğŸ”Œ ConexÃ£o Supabase</div></div>
        <div class="card-body">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">URL do Projeto</label>
              <input class="form-input" value="https://vqrwjassqebxjtnzppku.supabase.co" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Project Ref</label>
              <input class="form-input" value="vqrwjassqebxjtnzppku" readonly>
            </div>
            <div class="form-group full">
              <label class="form-label">Status da ConexÃ£o</label>
              <div id="connStatus" style="padding:10px 14px;border-radius:7px;font-size:13px;background:var(--s2);border:1px solid var(--s4)">
                Verificando...
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head"><div class="card-title">ğŸ” Senha do Admin</div></div>
        <div class="card-body">
          <p style="font-size:13px;color:var(--tx2);margin-bottom:16px">
            A senha Ã© definida na variÃ¡vel de ambiente <code style="color:var(--r3)">ADMIN_SECRET</code> na Edge Function do Supabase.<br>
            Acesse: <strong>Supabase â†’ Edge Functions â†’ admin-api â†’ Secrets</strong>
          </p>
          <div style="background:var(--s2);border:1px solid var(--bd);border-radius:8px;padding:14px;font-family:monospace;font-size:12px;color:var(--r3)">
            ADMIN_SECRET = sua-senha-aqui
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head"><div class="card-title">ğŸ“¦ Sobre o Sistema</div></div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:13px">
            <div><span style="color:var(--tx3)">VersÃ£o Admin:</span> <span style="color:var(--r3)">1.0.0</span></div>
            <div><span style="color:var(--tx3)">ExtensÃ£o:</span> <span style="color:var(--r3)">Original v1.0.0</span></div>
            <div><span style="color:var(--tx3)">Plataforma:</span> <span style="color:var(--r3)">Lovable.dev</span></div>
            <div><span style="color:var(--tx3)">Supabase:</span> <span style="color:var(--r3)">vqrwjassqebxjtnzppku</span></div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /app -->

<!-- â•â• MODAL: CRIAR LICENÃ‡A â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalCreate">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">NOVA LICENÃ‡A</div>
      <button class="modal-close" onclick="closeModal('modalCreate')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid" style="gap:14px">
        <div class="form-group">
          <label class="form-label">Plano</label>
          <select class="form-select" id="mPlan">
            <option value="pro">Pro</option>
            <option value="trial">Trial</option>
            <option value="lifetime">Lifetime</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">MÃ¡x. AtivaÃ§Ãµes</label>
          <input class="form-input" type="number" id="mMaxAct" value="1" min="1">
        </div>
        <div class="form-group full">
          <label class="form-label">Email (opcional)</label>
          <input class="form-input" type="email" id="mEmail" placeholder="cliente@email.com">
        </div>
        <div class="form-group">
          <label class="form-label">Expira em (dias)</label>
          <input class="form-input" type="number" id="mExpires" placeholder="Sem expiraÃ§Ã£o">
        </div>
        <div class="form-group">
          <label class="form-label">Quantidade</label>
          <input class="form-input" type="number" id="mQty" value="1" min="1" max="50">
        </div>
        <div class="form-group full">
          <label class="form-label">Notas</label>
          <input class="form-input" id="mNotes" placeholder="AnotaÃ§Ã£o interna...">
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" onclick="closeModal('modalCreate')">Cancelar</button>
      <button class="btn btn-primary" onclick="createLicense()">ğŸ”¥ Criar LicenÃ§a</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL: EDITAR LICENÃ‡A â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="modalEdit">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">EDITAR LICENÃ‡A</div>
      <button class="modal-close" onclick="closeModal('modalEdit')">âœ•</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="editId">
      <div style="margin-bottom:14px">
        <div class="form-label" style="margin-bottom:6px">Chave</div>
        <div class="key-box" id="editKeyDisplay">â€”</div>
      </div>
      <div class="form-grid" style="gap:14px">
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="editStatus">
            <option value="active">Ativa</option>
            <option value="suspended">Suspensa</option>
            <option value="expired">Expirada</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Plano</label>
          <select class="form-select" id="editPlan">
            <option value="pro">Pro</option>
            <option value="trial">Trial</option>
            <option value="lifetime">Lifetime</option>
          </select>
        </div>
        <div class="form-group full">
          <label class="form-label">Email</label>
          <input class="form-input" type="email" id="editEmail">
        </div>
        <div class="form-group">
          <label class="form-label">MÃ¡x. AtivaÃ§Ãµes</label>
          <input class="form-input" type="number" id="editMaxAct" min="1">
        </div>
        <div class="form-group">
          <label class="form-label">Expira em</label>
          <input class="form-input" type="datetime-local" id="editExpires">
        </div>
        <div class="form-group full">
          <label class="form-label">Notas</label>
          <input class="form-input" id="editNotes">
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" onclick="closeModal('modalEdit')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveEdit()">Salvar AlteraÃ§Ãµes</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ORIGINAL ADMIN â€” JavaScript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const SUPABASE_URL = 'https://vqrwjassqebxjtnzppku.supabase.co';
const ADMIN_API    = SUPABASE_URL + '/functions/v1/admin-api';
const ANON_KEY     = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxcndqYXNzcWVieGp0bnpwcGt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjM2ODEsImV4cCI6MjA4NzA5OTY4MX0.CUteH_AHLkqdt6q-X-m8V5w_-GSM3kWHb87HbD0bsJc';

let adminToken = null;
let allLicenses = [];
let currentPage = 1;
const PAGE_SIZE = 50;

// â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(action, extra = {}) {
  const res = await fetch(ADMIN_API, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'apikey': ANON_KEY,
      'Authorization': 'Bearer ' + ANON_KEY,
    },
    body: JSON.stringify({ action, token: adminToken, ...extra }),
  });
  try { return await res.json(); }
  catch { return { error: 'Erro de conexÃ£o' }; }
}

// â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin() {
  const pass = document.getElementById('loginPass').value.trim();
  if (!pass) return;

  const res = await fetch(ADMIN_API, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'apikey': ANON_KEY, 'Authorization': 'Bearer ' + ANON_KEY },
    body: JSON.stringify({ action: 'admin_login', token: 'none', password: pass }),
  }).then(r => r.json()).catch(() => ({ success: false }));

  if (res.success) {
    adminToken = res.token;
    localStorage.setItem('orig_admin_token', adminToken);
    showApp();
  } else {
    document.getElementById('loginErr').textContent = 'Senha incorreta';
    setTimeout(() => document.getElementById('loginErr').textContent = '', 3000);
  }
}

document.getElementById('loginPass').addEventListener('keydown', e => {
  if (e.key === 'Enter') doLogin();
});

function doLogout() {
  adminToken = null;
  localStorage.removeItem('orig_admin_token');
  document.getElementById('app').style.display = 'none';
  document.getElementById('loginScreen').style.display = 'flex';
}

function showApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  goPage('dashboard');
}

// Auto-login se tiver token salvo
window.addEventListener('DOMContentLoaded', () => {
  const saved = localStorage.getItem('orig_admin_token');
  if (saved) {
    adminToken = saved;
    showApp();
  }
});

// â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goPage(page) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

  const pageMap = {
    dashboard: 'pageDashboard',
    licenses: 'pageLicenses',
    generate: 'pageGenerate',
    logs: 'pageLogs',
    settings: 'pageSettings',
  };

  document.getElementById(pageMap[page]).style.display = 'block';
  document.querySelectorAll('.nav-item').forEach(n => {
    if (n.textContent.trim().toLowerCase().includes(page.slice(0,4))) n.classList.add('active');
  });

  if (page === 'dashboard') loadDashboard();
  if (page === 'licenses') loadLicenses();
  if (page === 'logs') loadLogs();
  if (page === 'settings') checkConnection();
}

// â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard() {
  const stats = await api('get_stats');
  if (!stats.error) {
    set('sTotalLicenses', stats.total_licenses ?? 'â€”');
    set('sActiveLicenses', stats.active_licenses ?? 'â€”');
    set('sSuspendedLicenses', stats.suspended_licenses ?? 'â€”');
    set('sValidationsToday', stats.validations_today ?? 'â€”');
  }

  // Logs recentes
  const logs = await api('get_logs', { limit: 20 });
  const el = document.getElementById('dashLogs');
  if (logs.logs && logs.logs.length) {
    el.innerHTML = logs.logs.map(renderLog).join('');
  } else {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“­</div><div class="empty-text">Nenhuma atividade recente</div></div>';
  }
}

function renderLog(log) {
  const date = new Date(log.created_at).toLocaleString('pt-BR');
  const cls = `log-${log.action || 'validate'}`;
  return `<div class="log-row">
    <div class="log-action ${cls}">${log.action || 'â€”'}</div>
    <div class="log-email">${log.email || 'anÃ´nimo'}</div>
    <div class="log-time">${date}</div>
  </div>`;
}

// â”€â”€ LICENSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadLicenses() {
  const search = document.getElementById('searchInput')?.value || '';
  const status = document.getElementById('filterStatus')?.value || '';
  const plan   = document.getElementById('filterPlan')?.value || '';

  const res = await api('list_licenses', { page: currentPage, limit: PAGE_SIZE, search, status });

  if (res.error) { toast('Erro ao carregar licenÃ§as', 'error'); return; }

  allLicenses = res.licenses || [];
  const total = res.total || 0;

  // Aplica filtro de plano no client (se necessÃ¡rio)
  let filtered = allLicenses;
  if (plan) filtered = filtered.filter(l => l.plan === plan);

  set('licenseCount', `${filtered.length} de ${total} licenÃ§as`);
  renderLicenses(filtered);

  // PaginaÃ§Ã£o
  const totalPages = Math.ceil(total / PAGE_SIZE);
  set('pageInfo', `PÃ¡gina ${currentPage} de ${totalPages} (${total} total)`);
  document.getElementById('btnPrev').disabled = currentPage <= 1;
  document.getElementById('btnNext').disabled = currentPage >= totalPages;
}

function filterLicenses() {
  currentPage = 1;
  loadLicenses();
}

function changePage(dir) {
  currentPage = Math.max(1, currentPage + dir);
  loadLicenses();
}

function renderLicenses(licenses) {
  const tbody = document.getElementById('licenseTbody');
  if (!licenses.length) {
    tbody.innerHTML = `<tr><td colspan="8"><div class="empty"><div class="empty-icon">ğŸ”</div><div class="empty-text">Nenhuma licenÃ§a encontrada</div></div></td></tr>`;
    return;
  }

  tbody.innerHTML = licenses.map(l => {
    const created = l.created_at ? new Date(l.created_at).toLocaleDateString('pt-BR') : 'â€”';
    const expires = l.expires_at ? new Date(l.expires_at).toLocaleDateString('pt-BR') : 'âˆ';
    const statusBadge = {
      active: '<span class="badge badge-active">â— Ativa</span>',
      suspended: '<span class="badge badge-suspended">â— Suspensa</span>',
      expired: '<span class="badge badge-expired">â— Expirada</span>',
      pending: '<span class="badge badge-pending">â— Pendente</span>',
    }[l.status] || l.status;
    const planBadge = {
      pro: '<span class="badge badge-pro">Pro</span>',
      trial: '<span class="badge badge-trial">Trial</span>',
      lifetime: '<span class="badge badge-lifetime">Lifetime</span>',
    }[l.plan] || l.plan;

    return `<tr>
      <td><span class="mono" title="${l.license_key}" onclick="copyText('${l.license_key}')" style="cursor:pointer">${l.license_key}</span></td>
      <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis">${l.email || '<span style="color:var(--tx3)">â€”</span>'}</td>
      <td>${planBadge}</td>
      <td>${statusBadge}</td>
      <td style="text-align:center">${l.activations || 0}/${l.max_activations || 1}</td>
      <td style="color:var(--tx2);font-size:12px">${created}</td>
      <td style="color:var(--tx2);font-size:12px">${expires}</td>
      <td>
        <div style="display:flex;gap:5px">
          <button class="btn btn-ghost btn-sm" onclick="openEditModal(${JSON.stringify(l).replace(/"/g,'&quot;')})">âœï¸</button>
          ${l.status==='active'
            ? `<button class="btn btn-danger btn-sm" onclick="revokeLicense('${l.id}')">ğŸš«</button>`
            : `<button class="btn btn-ghost btn-sm" onclick="reactivateLicense('${l.id}')">âœ“</button>`}
          <button class="btn btn-danger btn-sm" onclick="deleteLicense('${l.id}')">ğŸ—‘</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

// â”€â”€ LICENSE ACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function createLicense() {
  const res = await api('create_license', {
    email: val('mEmail') || null,
    plan: val('mPlan'),
    max_activations: parseInt(val('mMaxAct')) || 1,
    expires_days: val('mExpires') ? parseInt(val('mExpires')) : null,
    notes: val('mNotes') || null,
    quantity: parseInt(val('mQty')) || 1,
  });

  if (res.success) {
    toast(`${res.licenses.length} licenÃ§a(s) criada(s)!`, 'success');
    closeModal('modalCreate');
    loadLicenses();
  } else {
    toast(res.error || 'Erro ao criar', 'error');
  }
}

async function revokeLicense(id) {
  if (!confirm('Suspender esta licenÃ§a?')) return;
  const res = await api('revoke_license', { id });
  if (res.success) { toast('LicenÃ§a suspensa', 'success'); loadLicenses(); }
  else toast(res.error || 'Erro', 'error');
}

async function reactivateLicense(id) {
  const res = await api('update_license', { id, updates: { status: 'active' } });
  if (res.success) { toast('LicenÃ§a reativada', 'success'); loadLicenses(); }
  else toast(res.error || 'Erro', 'error');
}

async function deleteLicense(id) {
  if (!confirm('Excluir permanentemente esta licenÃ§a? Esta aÃ§Ã£o nÃ£o pode ser desfeita.')) return;
  const res = await api('delete_license', { id });
  if (res.success) { toast('LicenÃ§a excluÃ­da', 'success'); loadLicenses(); }
  else toast(res.error || 'Erro', 'error');
}

function openEditModal(l) {
  document.getElementById('editId').value = l.id;
  document.getElementById('editKeyDisplay').textContent = l.license_key;
  document.getElementById('editStatus').value = l.status;
  document.getElementById('editPlan').value = l.plan;
  document.getElementById('editEmail').value = l.email || '';
  document.getElementById('editMaxAct').value = l.max_activations || 1;
  document.getElementById('editNotes').value = l.notes || '';
  if (l.expires_at) {
    document.getElementById('editExpires').value = new Date(l.expires_at).toISOString().slice(0,16);
  } else {
    document.getElementById('editExpires').value = '';
  }
  document.getElementById('modalEdit').classList.add('open');
}

async function saveEdit() {
  const id = val('editId');
  const updates = {
    status: val('editStatus'),
    plan: val('editPlan'),
    email: val('editEmail') || null,
    max_activations: parseInt(val('editMaxAct')) || 1,
    notes: val('editNotes') || null,
  };
  if (val('editExpires')) updates.expires_at = new Date(val('editExpires')).toISOString();

  const res = await api('update_license', { id, updates });
  if (res.success) { toast('LicenÃ§a atualizada!', 'success'); closeModal('modalEdit'); loadLicenses(); }
  else toast(res.error || 'Erro', 'error');
}

function openCreateModal() {
  document.getElementById('modalCreate').classList.add('open');
}

// â”€â”€ GENERATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateLicenses() {
  const qty = parseInt(document.getElementById('genQty').value) || 1;

  const res = await api('create_license', {
    email: val('genEmail') || null,
    plan: val('genPlan'),
    max_activations: parseInt(val('genMaxAct')) || 1,
    expires_days: val('genExpires') ? parseInt(val('genExpires')) : null,
    notes: val('genNotes') || null,
    quantity: qty,
  });

  const area = document.getElementById('generatedKeysArea');
  const btnCopy = document.getElementById('btnCopyAll');

  if (res.success && res.licenses) {
    const keys = res.licenses.map(l => l.license_key || (l && l.license_key));
    area.innerHTML = keys.map(k => `
      <div class="gen-key-item">
        <span class="gen-key-text">${k}</span>
        <button class="btn btn-ghost btn-sm" onclick="copyText('${k}')">ğŸ“‹</button>
      </div>
    `).join('');
    btnCopy.style.display = 'inline-flex';
    btnCopy.dataset.keys = keys.join('\n');
    toast(`${keys.length} licenÃ§a(s) gerada(s)!`, 'success');
  } else {
    toast(res.error || 'Erro ao gerar', 'error');
  }
}

function copyAllKeys() {
  const keys = document.getElementById('btnCopyAll').dataset.keys;
  copyText(keys);
}

// â”€â”€ LOGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadLogs() {
  const logs = await api('get_logs', { limit: 200 });
  const el = document.getElementById('logsContainer');
  if (logs.logs && logs.logs.length) {
    el.innerHTML = logs.logs.map(renderLog).join('');
  } else {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“­</div><div class="empty-text">Nenhum log encontrado</div></div>';
  }
}

// â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkConnection() {
  const el = document.getElementById('connStatus');
  el.textContent = 'Verificando...';
  try {
    const res = await api('get_stats');
    if (!res.error) {
      el.style.color = 'var(--green)';
      el.style.borderColor = 'rgba(0,255,136,.2)';
      el.textContent = 'âœ“ Conectado ao Supabase com sucesso';
    } else {
      el.style.color = 'var(--red)';
      el.textContent = 'âœ— Erro: ' + res.error;
    }
  } catch {
    el.style.color = 'var(--red)';
    el.textContent = 'âœ— Sem conexÃ£o';
  }
}

// â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function exportCSV() {
  const res = await api('list_licenses', { page: 1, limit: 9999 });
  if (!res.licenses) { toast('Erro ao exportar', 'error'); return; }

  const headers = ['license_key','email','plan','status','activations','max_activations','created_at','expires_at','notes'];
  const rows = res.licenses.map(l => headers.map(h => `"${(l[h]||'').toString().replace(/"/g,'""')}"`).join(','));
  const csv = [headers.join(','), ...rows].join('\n');

  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = `original-licenses-${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  toast('CSV exportado!', 'success');
}

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function val(id) { return document.getElementById(id)?.value?.trim() || '' }
function set(id, v) { const el = document.getElementById(id); if(el) el.textContent = v }

function copyText(text) {
  navigator.clipboard.writeText(text).then(() => toast('Copiado!', 'success'));
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// Fecha modal clicando fora
document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); });
});

let toastTimer;
function toast(msg, type = 'success') {
  const el = document.getElementById('toast');
  const inner = document.getElementById('toastInner');
  inner.textContent = (type === 'success' ? 'âœ“ ' : 'âœ— ') + msg;
  inner.className = `toast-inner toast-${type}`;
  el.className = 'show';
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.className = '', 3000);
}
</script>
</body>
</html>
